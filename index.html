<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê³ ì–‘ì´ ê°€ë¼ì‚¬ëŒ€</title>
  </head>
  <style>
    body {
      text-align: center;
    }
    .main-card button {
      position: relative;
      left: -45px;
      bottom: 15px;
    }
    .favorites {
      list-style: none;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
    }
  </style>
  <body>
    <div id="app"></div>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script type="text/babel">
      const jsonLocalStorage = {
        // ë¡œì»¬ìŠ¤íŠ¸ë¦¬ì§€ì—” ë°ì´í„°ê°€ ë¬´ì¡°ê±´ Stringìœ¼ë¡œ ì €ì¥ë˜ì–´ì„œ í•´ì†Œí•  ìˆ˜ ìˆëŠ” ìœ í‹¸ ìƒì„±
        setItem: (key, value) => {
          localStorage.setItem(key, JSON.stringify(value));
        },
        getItem: (key) => {
          return JSON.parse(localStorage.getItem(key));
        },
      };
      console.log("ì•¼ì˜¹");

      const Title = (props) => {
        return (
          <h1>{props.children}</h1>
        )
      }

      const Form = ({ updateMainCat }) => {
        // í•œê¸€ íŒŒì•…í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ì •ê·œì‹
        const includesHangul = (text) => /[ã„±-ã…|ã…-ã…£|ê°€-í£]/i.test(text);
        const [value, setValue] = React.useState('')
        // ì—ëŸ¬ë©”ì„¸ì§€ì— ëŒ€í•œ ìƒíƒœ
        const [errorMessage, setErrorMessage] = React.useState('')

        // ê²€ìƒ‰ì°½ì— ì…ë ¥ì‹œ ë°˜ì‘í•˜ë„ë¡
        function handleInputChange(e) {
          // input ì°½ì— ì…ë ¥ì‹œ ì‹¤ì‹œê°„ìœ¼ë¡œ ê°’ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ e.target.value ì‚¬ìš©
          const userValue = e.target.value
          // ë¹ˆ ê°’ ê²€ì¦ ì „ì— ë¬´ì¡°ê±´ ì´ˆê¸°í™”í•˜ê¸°
          setErrorMessage('');

          // í•œê¸€ ì…ë ¥ì‹œ ì˜¤ë¥˜ë¬¸êµ¬ê°€ ë…¸ì¶œë˜ë„ë¡ ì„¤ì •
          if(includesHangul(userValue)) {
            setErrorMessage("í•œê¸€ì€ ì…ë ¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
          }

          // ì†Œë¬¸ì ì…ë ¥ì‹œ ëŒ€ë¬¸ìë¡œ ë‚˜ì˜¤ê²Œ í•´ì£¼ë„ë¡ toUpperCase ì‚¬ìš©
          setValue(userValue.toUpperCase())
        }

        function handleFormSubmit(e) {
          e.preventDefault();
          setErrorMessage('');
          // ë¹ˆ ê°’ìœ¼ë¡œ ìƒì„±ì„ í–ˆì„ ì‹œ ë¹ˆ ê°’ìœ¼ë¡œ ìƒì„±í•  ìˆ˜ ì—†ë‹¤ê³  ë…¸ì¶œ
          if(value === '') {
            // ì—ëŸ¬ë©”ì‹œì§€ë¥¼ ë³´ë‚´ì§€ê³  updateMainCatë¥¼ í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— returnì„ ë„£ì–´ì¤˜ì„œ í•¨ìˆ˜ê°€ updateMainCatê¹Œì§€ ë¶ˆë¦¬ì§€ ì•Šê³  ëë‚  ìˆ˜ ìˆê²Œ í•œë‹¤.
            setErrorMessage("ë¹ˆ ê°’ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return;
          } 
          updateMainCat();
        }
        return (
          <form onSubmit={handleFormSubmit}>
            <input 
              type="text" 
              name="name" 
              placeholder="ì˜ì–´ ëŒ€ì‚¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”" 
              value={value}
              onChange={handleInputChange}
            />
            <button type="submit">ìƒì„±</button>
            <p style={{color: 'red'}}>{errorMessage}</p>
          </form>
        )
      }

      function CatItem(props) {
        return (
          <li>
            <img src={props.img} style={{width: "150px"}}/>
          </li>
        )
       }

      function Favorites({ favorites }) {
        return (
          <ul className="favorites">
            {favorites.map((cat,i) => <CatItem img={cat} key={i}/>)}
          </ul>
        )
      }

      const MainCard = ({img, onHeartClick }) => {
        return (
          <div className="main-card">
            <img
              src={img}
              alt="ê³ ì–‘ì´"
              width="400"
            />
            <button onClick={onHeartClick}>ğŸ¤</button>
          </div>
        )
      }
      const App = () => {
        const CAT1 = "https://cataas.com/cat/HSENVDU4ZMqy7KQ0/says/react";
        const CAT2 = "https://cataas.com/cat/BxqL2EjFmtxDkAm2/says/inflearn";
        const CAT3 = "https://cataas.com/cat/18MD6byVC1yKGpXp/says/JavaScript";

        // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•œ ê°’ UIë¡œ ë…¸ì¶œ, ìŠ¤íŠ¸ë§ìœ¼ë¡œ ì €ì¥ë˜ê¸° ë•Œë¬¸ì— ìˆ«ìë¡œ ë³€í™˜ì„ ìœ„í•´ Number() ì•ˆì— ì ìš©
        const [counter, setCounter] = React.useState(
          jsonLocalStorage.getItem('counter')
        );
        const [mainCat, setMainCat] = React.useState(CAT1);
        // useStateì— jsonLocalStorage.getItem('favorites') ì´ê²ƒë§Œ ì„¤ì •í•˜ë©´ null map ì—ëŸ¬ê°€ ë‚œë‹¤. ì´ˆê¸°ê°’ì„ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— í•´ë‹¹ ë°ì´í„°ê°€ ì—†ì–´ì„œ ì—ëŸ¬ê°€ ë‚˜ëŠ” ê²ƒ
        const [favorites, setFavorites] = React.useState(
          jsonLocalStorage.getItem('favorites') || []
        )

        function updateMainCat(e) {
          // ì¹´ìš´í„°ë¥¼ ëŠ˜ë¦¬ëŠ” ê²ƒì€ ë¶€ê°€ì ì¸ ì˜µì…˜, ì´ë¯¸ì§€ ë¡œë“œê°€ ë¨¼ì €ì¼ ê²ƒ ê°™ê¸° ë•Œë¬¸ì—
          // setMainCat(CAT2) ë¨¼ì € ìœ„ì— ì˜¬ë¦¬ê¸°
          setMainCat(CAT2)
          const nextCounter = counter + 1;
          setCounter(nextCounter)
          // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ìˆëŠ” ì¹´ìš´í„°ë„ ê°™ì´ ì—…ë°ì´íŠ¸
          jsonLocalStorage.setItem('counter', nextCounter)
        }

        function handleHeartClick() {
          const nextFavorites = [...favorites, mainCat];
          jsonLocalStorage.setItem('favorites', nextFavorites)
          setFavorites(nextFavorites)
        }

        return (
          <div>
            <Title>{counter}ë²ˆì§¸ ê³ ì–‘ì´ ê°€ë¼ì‹œëŒ€</Title>
            <Form updateMainCat={updateMainCat}/>
            <MainCard img={mainCat} onHeartClick={handleHeartClick} />
            <Favorites favorites={favorites}/>
          </div>
        )
      }
      const ì—¬ê¸°ë‹¤ê°€ê·¸ë ¤ = document.querySelector('#app');

      ReactDOM.createRoot(ì—¬ê¸°ë‹¤ê°€ê·¸ë ¤).render(<App />);
    </script>
  </body>
</html>
